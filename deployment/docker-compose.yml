version: '3.8'

services:
  # UI Service (Frontend) - connects to Render backend services
  ui-service:
    build:
      context: ..
      dockerfile: deployment/Dockerfile
      # Build arguments for Next.js build-time environment variables
      args:
        - NEXT_PUBLIC_USER_SERVICE_URL=${NEXT_PUBLIC_USER_SERVICE_URL}
        - NEXT_PUBLIC_CONTENT_SERVICE_URL=${NEXT_PUBLIC_CONTENT_SERVICE_URL}
        - NEXT_PUBLIC_MONETIZATION_SERVICE_URL=${NEXT_PUBLIC_MONETIZATION_SERVICE_URL}
    container_name: memetomoney-ui-service
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # Node Environment
      NODE_ENV: ${NODE_ENV:-production}
      PORT: 3000

      # Backend Service URLs (Your Render URLs)
      # Replace these with your actual Render service URLs
      USER_SERVICE_URL: ${USER_SERVICE_URL:-https://your-user-service.onrender.com}
      CONTENT_SERVICE_URL: ${CONTENT_SERVICE_URL:-https://your-content-service.onrender.com}
      MONETIZATION_SERVICE_URL: ${MONETIZATION_SERVICE_URL:-https://your-monetization-service.onrender.com}

      # Public environment variables for client-side (Render URLs)
      NEXT_PUBLIC_USER_SERVICE_URL: ${NEXT_PUBLIC_USER_SERVICE_URL:-https://your-user-service.onrender.com}
      NEXT_PUBLIC_CONTENT_SERVICE_URL: ${NEXT_PUBLIC_CONTENT_SERVICE_URL:-https://your-content-service.onrender.com}
      NEXT_PUBLIC_MONETIZATION_SERVICE_URL: ${NEXT_PUBLIC_MONETIZATION_SERVICE_URL:-https://your-monetization-service.onrender.com}

      # Optional: Additional configuration
      NEXT_PUBLIC_CDN_BASE_URL: ${CDN_BASE_URL:-https://cdn.memetomoney.com}
      NEXT_PUBLIC_UPLOAD_BASE_URL: ${UPLOAD_BASE_URL:-https://upload.memetomoney.com}

      # Optional: Firebase Configuration (if using)
      NEXT_PUBLIC_FIREBASE_API_KEY: ${NEXT_PUBLIC_FIREBASE_API_KEY:-}
      NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: ${NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:-}
      NEXT_PUBLIC_FIREBASE_PROJECT_ID: ${NEXT_PUBLIC_FIREBASE_PROJECT_ID:-}
      NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: ${NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:-}
      NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: ${NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:-}
      NEXT_PUBLIC_FIREBASE_APP_ID: ${NEXT_PUBLIC_FIREBASE_APP_ID:-}

      # Optional: Google Cloud Configuration
      GOOGLE_CLOUD_PROJECT_ID: ${GOOGLE_CLOUD_PROJECT_ID:-}
    networks:
      - memetomoney-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  memetomoney-network:
    driver: bridge